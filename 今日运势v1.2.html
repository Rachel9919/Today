<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…«å­—çœŸå¤ªé˜³æ—¶è¿åŠ¿ç³»ç»Ÿ v2.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #fdfbf7;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* äº”è¡Œé¢œè‰²å®šä¹‰ */
        .wx-é‡‘ { color: #d97706; font-weight: bold; }
        .wx-æœ¨ { color: #15803d; font-weight: bold; }
        .wx-æ°´ { color: #2563eb; font-weight: bold; }
        .wx-ç« { color: #dc2626; font-weight: bold; }
        .wx-åœŸ { color: #854d0e; font-weight: bold; }
        
        /* è¿åŠ¿å¡ç‰‡æ ·å¼ */
        .luck-great { border-left: 4px solid #16a34a; background: #f0fdf4; }
        .luck-good { border-left: 4px solid #ca8a04; background: #fefce8; }
        .luck-normal { border-left: 4px solid #9ca3af; background: #f9fafb; }
        .luck-warn { border-left: 4px solid #ea580c; background: #fff7ed; }
        .luck-bad { border-left: 4px solid #dc2626; background: #fef2f2; }
    </style>
</head>
<body class="text-gray-800 min-h-screen pb-12">

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="bg-gradient-to-r from-red-900 to-red-800 text-orange-50 py-5 shadow-xl relative overflow-hidden">
        <div class="absolute -right-10 -top-10 text-9xl opacity-10 rotate-12 select-none">é‹</div>
        <div class="container mx-auto px-4 text-center relative z-10">
            <h1 class="text-2xl md:text-3xl font-bold tracking-widest">å¤©æœº Â· è¿åŠ¿æŒ‡å—</h1>
            <p class="text-xs md:text-sm text-red-200 mt-2">çœŸå¤ªé˜³æ—¶æ’ç›˜ | è´¢è¿åˆ†æ | ç©¿æ­å»ºè®®</p>
        </div>
    </header>

    <main class="container mx-auto px-4 mt-8 max-w-4xl">

        <!-- è¾“å…¥åŒºåŸŸ -->
        <div id="inputSection" class="bg-white rounded-2xl shadow-lg p-6 md:p-8 border border-gray-100 mb-8 transition-all hover:shadow-xl">
            <div class="flex items-center mb-6">
                <div class="w-1 h-6 bg-red-800 mr-3 rounded"></div>
                <h2 class="text-lg font-bold text-gray-800">è¯·è¾“å…¥å‡ºç”Ÿä¿¡æ¯</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- æ—¥æœŸ -->
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-2">å‡ºç”Ÿæ—¥æœŸ (å…¬å†)</label>
                    <input type="date" id="birthDate" class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition">
                </div>
                
                <!-- æ—¶é—´ -->
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-2">æ—¶</label>
                        <select id="birthHour" class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 outline-none">
                            <!-- JS ç”Ÿæˆ -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-2">åˆ†</label>
                        <select id="birthMinute" class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 outline-none">
                            <!-- JS ç”Ÿæˆ -->
                        </select>
                    </div>
                </div>

                <!-- æ€§åˆ« -->
                <div class="flex flex-col justify-center">
                    <label class="block text-sm font-medium text-gray-600 mb-2">æ€§åˆ«</label>
                    <div class="flex space-x-6">
                        <label class="flex items-center cursor-pointer group">
                            <input type="radio" name="gender" value="1" checked class="w-4 h-4 text-red-600 focus:ring-red-500 border-gray-300">
                            <span class="ml-2 group-hover:text-red-700 transition">ç”· (ä¹¾é€ )</span>
                        </label>
                        <label class="flex items-center cursor-pointer group">
                            <input type="radio" name="gender" value="0" class="w-4 h-4 text-red-600 focus:ring-red-500 border-gray-300">
                            <span class="ml-2 group-hover:text-red-700 transition">å¥³ (å¤é€ )</span>
                        </label>
                    </div>
                </div>

                <!-- å‡ºç”Ÿåœ°ç»åº¦ -->
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-2 flex justify-between">
                        <span>å‡ºç”ŸåŸå¸‚ (ç»åº¦æ ¡æ­£çœŸå¤ªé˜³æ—¶)</span>
                        <a href="https://jingweidu.51240.com/" target="_blank" class="text-red-500 text-xs hover:underline">æŸ¥è¯¢ç»åº¦</a>
                    </label>
                    <div class="flex gap-2">
                        <select id="citySelect" class="w-1/3 bg-gray-50 border border-gray-300 rounded-lg p-3 text-sm outline-none" onchange="setLongitude(this.value)">
                            <option value="">å¿«é€Ÿé€‰æ‹©</option>
                            <option value="116.40">åŒ—äº¬</option>
                            <option value="121.47">ä¸Šæµ·</option>
                            <option value="113.26">å¹¿å·</option>
                            <option value="114.05">æ·±åœ³</option>
                            <option value="104.06">æˆéƒ½</option>
                            <option value="106.55">é‡åº†</option>
                            <option value="118.78">å—äº¬</option>
                            <option value="114.16">é¦™æ¸¯</option>
                            <option value="121.50">å°åŒ—</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                        <input type="number" id="longitude" placeholder="å¦‚ 116.40" step="0.01" value="120.00" class="flex-1 bg-gray-50 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-red-500 outline-none">
                    </div>
                </div>
            </div>

            <button onclick="calculateBazi()" class="w-full mt-8 bg-red-900 hover:bg-red-800 text-white font-bold py-4 px-6 rounded-lg transition duration-200 shadow-lg transform hover:-translate-y-0.5 active:translate-y-0">
                ğŸ”® ç«‹å³åˆ†æä»Šæ—¥è¿åŠ¿
            </button>
            <p class="text-xs text-gray-400 text-center mt-3">æ•°æ®ä»…åœ¨æœ¬åœ°è®¡ç®—ï¼Œä¸ä¼šä¸Šä¼ è‡³æœåŠ¡å™¨</p>
        </div>

        <!-- ç»“æœå±•ç¤ºåŒº -->
        <div id="resultSection" class="hidden space-y-8">
            
            <!-- 0. ä¸ªäººèº«ä»½å¡ -->
            <div class="bg-gray-800 text-gray-200 rounded-xl p-4 shadow-md flex flex-col md:flex-row justify-between items-center text-sm fade-in">
                <div class="mb-2 md:mb-0">
                    <span class="text-gray-400">æ‚¨çš„æ—¥æŸ±(è‡ªå·±)ï¼š</span>
                    <span id="userDayPillar" class="text-xl font-bold text-white ml-2">--</span>
                    <span id="userIdentityDesc" class="ml-2 bg-gray-700 px-2 py-1 rounded text-xs text-yellow-500"></span>
                </div>
                <div class="text-gray-400 text-xs text-center md:text-right">
                    <p>ğŸ’¡ æç¤ºï¼šä»Šæ—¥è¿åŠ¿é‡ç‚¹åˆ†æ <strong>æ—¥æŸ±</strong> ä¸ <strong>æµæ—¥</strong> çš„äº’åŠ¨ã€‚</p>
                </div>
            </div>

            <!-- 1. ä»Šæ—¥æ ¸å¿ƒè¿åŠ¿ (æ—¥æŸ± vs æµæ—¥) -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 fade-in">
                <div class="bg-gradient-to-r from-red-50 to-orange-50 px-6 py-4 border-b border-red-100 flex justify-between items-center">
                    <div>
                        <h3 class="font-bold text-red-900 text-lg">ğŸ“… ä»Šæ—¥è¿åŠ¿æŒ‡å¼•</h3>
                        <p id="todayDateStr" class="text-xs text-gray-500 mt-1"></p>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-400">ä»Šæ—¥æµæ—¥</div>
                        <div id="todayGanzhi" class="text-2xl font-serif font-bold text-gray-800 opacity-80">--</div>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- é‡ç‚¹ï¼šæ—¥æŸ±äº’åŠ¨åˆ†æ -->
                    <div id="interactionCard" class="mb-6 p-4 rounded-lg luck-normal">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-bold text-gray-800 flex items-center">
                                <span class="text-lg mr-2">âš¡</span>
                                æ—¥æŸ±åº”æœŸäº’åŠ¨
                            </h4>
                            <span id="interactionBadge" class="text-xs font-bold px-2 py-1 bg-gray-200 text-gray-600 rounded">å¹³ç¨³</span>
                        </div>
                        <h5 id="interactionTitle" class="text-lg font-bold text-gray-900 mb-1">--</h5>
                        <p id="interactionDesc" class="text-sm text-gray-700 leading-relaxed">--</p>
                    </div>

                    <!-- ã€æ–°å¢ã€‘ä»Šæ—¥è´¢è¿å¡ç‰‡ -->
                    <div class="bg-gradient-to-r from-yellow-50 to-amber-50 rounded-xl p-4 border border-yellow-200 shadow-sm mb-8 transform transition hover:scale-[1.01]">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-yellow-900 flex items-center text-lg mb-1">
                                    <span class="text-2xl mr-2">ğŸ’°</span> ä»Šæ—¥è´¢è¿
                                </h4>
                                <p id="wealthDesc" class="text-sm text-yellow-800 opacity-90">--</p>
                            </div>
                            <div class="text-right">
                                <div id="wealthScore" class="text-yellow-500 text-lg tracking-widest mb-1">â­â­â­</div>
                                <div class="text-xs text-yellow-700 bg-white bg-opacity-60 px-2 py-1 rounded-full inline-block font-bold">
                                    ğŸ§­ è´¢ç¥ä½ï¼š<span id="caiShenPos">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- å·¦ä¾§ï¼šåç¥æ°›å›´ -->
                        <div>
                            <div class="flex items-center mb-3">
                                <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded mr-2">ç¯å¢ƒæ°”åœº</span>
                                <h4 id="todayTenGodTitle" class="font-bold text-gray-800">--</h4>
                            </div>
                            <p id="todayTenGodDesc" class="text-gray-600 text-sm leading-relaxed mb-4">--</p>
                        </div>

                        <!-- å³ä¾§ï¼šè¡ŒåŠ¨å»ºè®® -->
                        <div class="border-t md:border-t-0 md:border-l border-dashed border-gray-200 pt-6 md:pt-0 md:pl-8">
                             <div class="flex items-center mb-3">
                                <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded mr-2">ä»Šæ—¥å®œå¿Œ & ç©¿æ­</span>
                                <h4 class="font-bold text-gray-800">ç”Ÿæ´»è´´å£«</h4>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="bg-orange-50 p-3 rounded-lg border border-orange-100 transition hover:shadow-md">
                                    <div class="flex items-center mb-1">
                                        <span class="text-lg mr-2">ğŸ¨</span>
                                        <span class="text-xs font-bold text-gray-500">å¹¸è¿è‰² (æå‡èƒ½é‡)</span>
                                    </div>
                                    <span id="luckyColor" class="text-sm font-bold text-gray-800 block">--</span>
                                </div>
                                <div class="bg-green-50 p-3 rounded-lg border border-green-100 transition hover:shadow-md">
                                    <div class="flex items-center mb-1">
                                        <span class="text-lg mr-2">ğŸ§˜</span>
                                        <span class="text-xs font-bold text-gray-500">å®œåšä¹‹äº‹ (é¡ºåŠ¿è€Œä¸º)</span>
                                    </div>
                                    <span id="luckyAction" class="text-sm text-gray-800 block leading-relaxed">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. å…«å­—åŸå±€ (Visual Chart) -->
            <div class="bg-white rounded-xl shadow-md p-6 fade-in">
                <h3 class="text-center font-bold text-gray-800 mb-6 relative">
                    <span class="bg-white px-4 relative z-10">æ‚¨çš„å…«å­—åŸå±€</span>
                    <div class="absolute w-full h-px bg-gray-200 top-1/2 left-0 z-0"></div>
                </h3>

                <div class="grid grid-cols-4 gap-2 md:gap-4">
                    <!-- è¡¨å¤´ -->
                    <div class="text-center text-xs text-gray-400">å¹´æŸ± (ç”Ÿè‚–)</div>
                    <div class="text-center text-xs text-gray-400">æœˆæŸ±</div>
                    <div class="text-center text-xs text-gray-400 text-red-600 font-bold">æ—¥æŸ± (è‡ªå·±)</div>
                    <div class="text-center text-xs text-gray-400">æ—¶æŸ±</div>

                    <!-- æŸ±å­å¡ç‰‡ -->
                    <div id="yearPillar" class="bg-gray-50 rounded-lg py-4 text-center border border-gray-100"></div>
                    <div id="monthPillar" class="bg-gray-50 rounded-lg py-4 text-center border border-gray-100"></div>
                    <div id="dayPillar" class="bg-red-50 rounded-lg py-4 text-center border border-red-200 shadow-sm transform scale-105 ring-2 ring-red-100"></div>
                    <div id="hourPillar" class="bg-gray-50 rounded-lg py-4 text-center border border-gray-100"></div>
                </div>
            </div>

        </div>
    </main>

    <script>
        // --- åˆå§‹åŒ–é€»è¾‘ ---
        const now = new Date();
        document.getElementById('birthDate').valueAsDate = now;

        const hourSelect = document.getElementById('birthHour');
        for(let i=0; i<24; i++) hourSelect.add(new Option(i + " æ—¶", i));
        hourSelect.value = 12;

        const minSelect = document.getElementById('birthMinute');
        for(let i=0; i<60; i++) minSelect.add(new Option(i + " åˆ†", i));
        minSelect.value = 30;

        function setLongitude(val) {
            if(val && val !== 'other') document.getElementById('longitude').value = val;
        }

        // --- å…¨å±€æ•°æ®å®šä¹‰ ---
        const ganHe = {"ç”²":"å·±", "å·±":"ç”²", "ä¹™":"åºš", "åºš":"ä¹™", "ä¸™":"è¾›", "è¾›":"ä¸™", "ä¸":"å£¬", "å£¬":"ä¸", "æˆŠ":"ç™¸", "ç™¸":"æˆŠ"};
        const ganChong = {"ç”²":"åºš", "åºš":"ç”²", "ä¹™":"è¾›", "è¾›":"ä¹™", "ä¸™":"å£¬", "å£¬":"ä¸™", "ä¸":"ç™¸", "ç™¸":"ä¸"};
        const zhiHe = {"å­":"ä¸‘", "ä¸‘":"å­", "å¯…":"äº¥", "äº¥":"å¯…", "å¯":"æˆŒ", "æˆŒ":"å¯", "è¾°":"é…‰", "é…‰":"è¾°", "å·³":"ç”³", "ç”³":"å·³", "åˆ":"æœª", "æœª":"åˆ"};
        const zhiChong = {"å­":"åˆ", "åˆ":"å­", "ä¸‘":"æœª", "æœª":"ä¸‘", "å¯…":"ç”³", "ç”³":"å¯…", "å¯":"é…‰", "é…‰":"å¯", "è¾°":"æˆŒ", "æˆŒ":"è¾°", "å·³":"äº¥", "äº¥":"å·³"};

        const GAN_WX = {"ç”²":"æœ¨", "ä¹™":"æœ¨", "ä¸™":"ç«", "ä¸":"ç«", "æˆŠ":"åœŸ", "å·±":"åœŸ", "åºš":"é‡‘", "è¾›":"é‡‘", "å£¬":"æ°´", "ç™¸":"æ°´"};
        const ZHI_WX = {"å­":"æ°´", "ä¸‘":"åœŸ", "å¯…":"æœ¨", "å¯":"æœ¨", "è¾°":"åœŸ", "å·³":"ç«", "åˆ":"ç«", "æœª":"åœŸ", "ç”³":"é‡‘", "é…‰":"é‡‘", "æˆŒ":"åœŸ", "äº¥":"æ°´"};

        const elementColors = {
            "æœ¨": "ğŸŒ² ç»¿è‰²ã€è–„è·ç»¿ã€é’è‰²",
            "ç«": "ğŸ”¥ çº¢è‰²ã€ç²‰è‰²ã€ç´«è‰²ã€æš–æ©˜",
            "åœŸ": "ğŸŸ¤ å§œé»„ã€å¡å…¶è‰²ã€ç±³ç™½ã€å’–å•¡è‰²",
            "é‡‘": "âšª ç™½è‰²ã€é“¶ç°ã€é¦™æ§Ÿé‡‘",
            "æ°´": "ğŸ’§ é»‘è‰²ã€æ·±è“ã€é›¾éœ¾è“"
        };

        // åç¥ - ç”Ÿæ´»å»ºè®®ä¸è´¢è¿æ˜ å°„
        // rel: äº”è¡Œå…³ç³» (0åŒ, 1ç”Ÿ, 2å…‹, 3è¢«å…‹, 4è¢«ç”Ÿ)
        const tenGodAdvice = {
            "æ¯”è‚©": { title: "æ¯”è‚©æ—¥ Â· æœ‹å‹ä¸ç«äº‰", desc: "èƒ½é‡ç›¸åŒï¼Œåˆ©äºåˆä½œã€‚é€‚åˆå›¢ä½“æ´»åŠ¨ï¼Œä½†ä¹°å•æ—¶AAåˆ¶ä¸ºä½³ã€‚", action: "çº¦æœ‹å‹åƒç«é”…ã€å›¢é˜Ÿè¿åŠ¨ã€æ‹¼å•è´­ç‰©", rel: 0 },
            "åŠ«è´¢": { title: "åŠ«è´¢æ—¥ Â· ç ´è€—ä¸å¿™ç¢Œ", desc: "æ˜“å†²åŠ¨æ¶ˆè´¹ï¼Œæ‚ç´§é’±åŒ…ã€‚é€‚åˆä¸»åŠ¨è¯·å®¢èŠ±é’±å…ç¾ï¼Œä¸åšé£é™©æŠ•èµ„ã€‚", action: "ç»™è‡ªå·±ä¹°ç¤¼ç‰©ã€è¯·å®¢åƒé¥­ã€å¥èº«æš´æ±—", rel: 1 },
            "é£Ÿç¥": { title: "é£Ÿç¥æ—¥ Â· äº«ä¹ä¸å£ç¦", desc: "å¿ƒæƒ…èˆ’ç•…ï¼Œå£ç¦ä¸æµ…ã€‚ä»Šå¤©æ‰åæ¨ªæº¢ï¼Œé€‚åˆåƒå–ç©ä¹ã€‚", action: "æ¢åº—æ–°é¤å…ã€çœ‹ç”µå½±ã€å”±KTVã€åšSPA", rel: 2 },
            "ä¼¤å®˜": { title: "ä¼¤å®˜æ—¥ Â· åˆ›æ„ä¸æ˜¯é", desc: "è„‘æ´å¤§å¼€ï¼Œåˆ©äºè§£å†³éš¾é¢˜ã€‚åˆ«æ€¼è€æ¿ï¼Œä½è°ƒåšäººã€‚", action: "æ¢å‘å‹ã€ç©å‰§æœ¬æ€ã€å¤´è„‘é£æš´ã€å†™æ—¥è®°", rel: 4 },
            "æ­£è´¢": { title: "æ­£è´¢æ—¥ Â· è¸å®ä¸æ”¶è·", desc: "è´¢è¿å¹³ç¨³ï¼Œå¤šåŠ³å¤šå¾—ã€‚æŠŠé’±èŠ±åœ¨åˆ€åˆƒä¸Šï¼Œé€‚åˆå­˜é’±ã€‚", action: "æ•´ç†æˆ¿é—´ã€è®°è´¦ç†è´¢ã€æ·»ç½®å®¶å±…ã€åŠ ç­æ¬ç –", rel: 3 },
            "åè´¢": { title: "åè´¢æ—¥ Â· æœºé‡ä¸äººé™…", desc: "äººç¼˜å¥½ï¼Œæ¡ƒèŠ±æ—ºã€‚é€‚åˆå•†ä¸šè°ˆåˆ¤ï¼Œæˆ–è€…ä¹°å¼ å½©ç¥¨ç¢°è¿æ°”ã€‚", action: "ä¹°å½©ç¥¨ã€å•†åŠ¡å±€ã€çº¦ä¼šè¡¨ç™½ã€ç ”ç©¶åŸºé‡‘", rel: 2 },
            "æ­£å®˜": { title: "æ­£å®˜æ—¥ Â· ç§©åºä¸è´µäºº", desc: "æ˜“å¾—é¢†å¯¼èµè¯†ã€‚é€‚åˆåšæ­£ç»äº‹ï¼Œç©¿å¾—æ­£å¼ç‚¹è¿æ°”æ›´å¥½ã€‚", action: "åˆ¶å®šè®¡åˆ’ã€é¢è¯•æ±‚èŒã€ç©¿æ­£è£…ã€æ‹œè®¿å®¢æˆ·", rel: 4 },
            "ä¸ƒæ€": { title: "ä¸ƒæ€æ—¥ Â· å‹åŠ›ä¸é­„åŠ›", desc: "å‹åŠ›å¤§åŠ¨åŠ›è¶³ã€‚é€‚åˆå¤„ç†ç¡¬éª¨å¤´ï¼Œè¿åŠ¨å‡ºæ±—è§£å‹ã€‚", action: "é«˜å¼ºåº¦è¿åŠ¨(HIIT)ã€å¤§æ‰«é™¤ã€è§£å†³ç§¯å‹éš¾é¢˜", rel: 1 },
            "æ­£å°": { title: "æ­£å°æ—¥ Â· å­¦ä¹ ä¸å®‰é€¸", desc: "è´µäººè¿å¥½ï¼Œè„‘å­å¥½ä½¿ã€‚é€‚åˆä½›ç³»å…»ç”Ÿï¼Œä¼‘å…»ç”Ÿæ¯ã€‚", action: "æ³¡æ¾¡å…»ç”Ÿã€çœ‹ä¹¦å­¦ä¹ ã€ç¥ˆç¦ã€çœ‹æœ›çˆ¶æ¯", rel: 0 },
            "åå°": { title: "åå°æ—¥ Â· çµæ„Ÿä¸å­¤ç‹¬", desc: "ç›´è§‰å‡†ï¼Œæƒ³æ³•ç‹¬ç‰¹ã€‚é€‚åˆé’»ç ”å†·é—¨çŸ¥è¯†ï¼Œç‹¬å¤„å……ç”µã€‚", action: "å†¥æƒ³æ‰“åã€ç ”ç©¶ç„å­¦ã€å¬å°ä¼—éŸ³ä¹ã€ç‹¬å¤„", rel: 2 }
        };

        // ã€æ–°å¢ã€‘è´¢è¿è¯„åˆ†è¡¨
        const wealthMap = {
            "æ¯”è‚©": { score: "â­â­", desc: "è´¢è¿å¹³å¹³ï¼Œé€‚åˆåˆä½œæ±‚è´¢ï¼Œä½†éœ€é˜²å…„å¼Ÿæœ‹å‹åˆ†åˆ©ï¼Œä¸å®œå€Ÿè´·ã€‚" },
            "åŠ«è´¢": { score: "â­", desc: "è´¢æ˜Ÿå—å…‹ï¼Œå®¹æ˜“æœ‰å†²åŠ¨æ¶ˆè´¹æˆ–ç ´è´¢ä¹‹äº‹ï¼Œæ‚ç´§é’±åŒ…ï¼Œé¿å…æŠ•èµ„ã€‚" },
            "é£Ÿç¥": { score: "â­â­â­â­", desc: "è´¢æºæœ‰æ ¹ï¼Œå‡­å€Ÿæ‰åæˆ–æŠ€æœ¯ç”Ÿè´¢ï¼Œè½»æ¾è·åˆ©ï¼Œé€‚åˆåƒå–è°ˆç”Ÿæ„ã€‚" },
            "ä¼¤å®˜": { score: "â­â­â­â­", desc: "ç”Ÿè´¢æœ‰é“ï¼Œåˆ›æ„ç”Ÿè´¢ï¼Œåˆ©äºé™©ä¸­æ±‚èƒœï¼Œä½†éœ€æ³¨æ„æ–¹å¼æ–¹æ³•ã€‚" },
            "æ­£è´¢": { score: "â­â­â­â­â­", desc: "è´¢æ˜Ÿå½“ä»¤ï¼Œæ­£è´¢è¿æ—ºï¼ŒåŠªåŠ›å·¥ä½œæœ‰å›æŠ¥ï¼Œé€‚åˆç†è´¢å‚¨è“„ï¼Œç§¯å°‘æˆå¤šã€‚" },
            "åè´¢": { score: "â­â­â­â­â­", desc: "è´¢æ°”é€šé—¨æˆ·ï¼Œåè´¢è¿ä½³ï¼Œåˆ©äºæŠ•èµ„ã€å¥–é‡‘æˆ–æ„å¤–ä¹‹è´¢ï¼Œå¯ä»¥ä¹°å¼ å½©ç¥¨è¯•è¯•ã€‚" },
            "æ­£å®˜": { score: "â­â­â­", desc: "è´¢æ°”ç¨³å®šï¼Œåˆ©äºèŒåœºæ­£è´¢ï¼Œå‡èŒåŠ è–ªæœ‰æœ›ï¼Œä½†éœ€æŒ‰éƒ¨å°±ç­ã€‚" },
            "ä¸ƒæ€": { score: "â­â­", desc: "è´¢è¿èµ·ä¼ï¼Œå‹åŠ›ä¸­æ±‚è´¢ï¼Œé£é™©è¾ƒå¤§ï¼Œå¯èƒ½å› æ„å¤–æ”¯å‡ºç ´è´¢ï¼Œå®œä¿å®ˆã€‚" },
            "æ­£å°": { score: "â­â­", desc: "è´¢è¿å¹³ç¨³ï¼Œåˆ©äºé•¿çº¿æŠ•èµ„æˆ–çŸ¥è¯†å˜ç°ï¼Œç°é‡‘æµä¸€èˆ¬ï¼Œé€‚åˆè§„åˆ’ã€‚" },
            "åå°": { score: "â­â­", desc: "è´¢è·¯ç‹¬ç‰¹ï¼Œé€‚åˆå†·é—¨åé—¨æ±‚è´¢ï¼Œç›´è§‰æ•é”ï¼Œä½†å®¹æ˜“é”™å¤±ä¸»æµæœºä¼šã€‚" }
        };

        // --- è®¡ç®—ä¸»å‡½æ•° ---
        function calculateBazi() {
            const dateStr = document.getElementById('birthDate').value;
            const hour = parseInt(document.getElementById('birthHour').value);
            const minute = parseInt(document.getElementById('birthMinute').value);
            const longitude = parseFloat(document.getElementById('longitude').value) || 120;

            if(!dateStr) { alert("è¯·é€‰æ‹©æ—¥æœŸ"); return; }

            const dateParts = dateStr.split('-');
            const offsetMin = (longitude - 120) * 4;
            let date = new Date(parseInt(dateParts[0]), parseInt(dateParts[1])-1, parseInt(dateParts[2]), hour, minute);
            let solarTimeMs = date.getTime() + (offsetMin * 60 * 1000);
            let solarDate = new Date(solarTimeMs);

            const solar = Solar.fromYmdHms(solarDate.getFullYear(), solarDate.getMonth()+1, solarDate.getDate(), solarDate.getHours(), solarDate.getMinutes(), solarDate.getSeconds());
            const lunar = solar.getLunar();
            const bazi = lunar.getEightChar();

            const today = Solar.fromDate(new Date());
            const todayLunar = today.getLunar();

            renderIdentity(bazi, lunar); 
            renderChart(bazi);
            renderDailyLuck(bazi, todayLunar);

            document.getElementById('resultSection').classList.remove('hidden');
            document.getElementById('resultSection').scrollIntoView({behavior: 'smooth'});
        }

        // --- æ¸²æŸ“èº«ä»½ ---
        function renderIdentity(bazi, lunar) {
            const dayGan = bazi.getDayGan(); 
            const dayZhi = bazi.getDayZhi();
            const dayWx = GAN_WX[dayGan]; 
            const zodiac = lunar.getYearShengXiao(); 

            const html = `${dayGan}${dayZhi} <span class="text-sm font-normal text-gray-400">(${dayWx}å‘½)</span>`;
            document.getElementById('userDayPillar').innerHTML = html;
            document.getElementById('userIdentityDesc').innerText = `å±${zodiac}`;
        }

        // --- æ¸²æŸ“å…«å­—ç›˜ ---
        function renderChart(bazi) {
            const pillars = [
                { id: 'yearPillar', val: bazi.getYear() },
                { id: 'monthPillar', val: bazi.getMonth() },
                { id: 'dayPillar', val: bazi.getDay() },
                { id: 'hourPillar', val: bazi.getTime() }
            ];

            const getWxHtml = (char) => {
                const gan = char.charAt(0);
                const zhi = char.charAt(1);
                const ganWx = GAN_WX[gan];
                const zhiWx = ZHI_WX[zhi];

                return `<div class="text-xl font-bold mb-1">
                            <span class="wx-${ganWx}">${gan}</span>
                            <br>
                            <span class="wx-${zhiWx}">${zhi}</span>
                        </div>`;
            };

            pillars.forEach(p => {
                document.getElementById(p.id).innerHTML = getWxHtml(p.val);
            });
        }

        // --- æ ¸å¿ƒï¼šæ¯æ—¥è¿åŠ¿ ---
        function renderDailyLuck(bazi, today) {
            // A. åŸºç¡€ä¿¡æ¯
            document.getElementById('todayDateStr').innerText = `${today.getYear()}å¹´${today.getMonth()}æœˆ${today.getDay()}æ—¥`;
            document.getElementById('todayGanzhi').innerText = today.getDayInGanZhi();

            // B. äº’åŠ¨é€»è¾‘
            const userGan = bazi.getDayGan();
            const userZhi = bazi.getDayZhi();
            const todayGan = today.getDayGan();
            const todayZhi = today.getDayZhi();
            const relation = analyzeInteraction(userGan, userZhi, todayGan, todayZhi);
            
            const card = document.getElementById('interactionCard');
            card.className = `mb-6 p-4 rounded-lg luck-${relation.type}`;
            document.getElementById('interactionBadge').innerText = relation.badge;
            document.getElementById('interactionTitle').innerText = relation.title;
            document.getElementById('interactionDesc').innerText = relation.desc;

            // C. åç¥ä¸å»ºè®®
            const me = bazi.getDayGan(); 
            const dayEnv = today.getDayGan(); 
            const meWx = GAN_WX[me]; 
            
            const tenGodName = getTenGodName(me, dayEnv);
            const advice = tenGodAdvice[tenGodName] || tenGodAdvice["æ¯”è‚©"]; 
            
            // D. è®¡ç®—è´¢è¿ä¿¡æ¯
            const wealthInfo = wealthMap[tenGodName] || wealthMap["æ¯”è‚©"];
            // è·å–è´¢ç¥æ–¹ä½ (æ¥è‡ª lunar åº“)
            const caiShenPos = today.getDayPositionCai();

            // å¡«å……è´¢è¿UI
            document.getElementById('wealthScore').innerText = wealthInfo.score;
            document.getElementById('wealthDesc').innerText = wealthInfo.desc;
            document.getElementById('caiShenPos').innerText = caiShenPos;

            // åŠ¨æ€è®¡ç®—å…·ä½“é¢œè‰²
            const elements = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];
            const meIdx = elements.indexOf(meWx);
            const targetIdx = (meIdx + advice.rel) % 5;
            const targetElement = elements[targetIdx];
            const specificColors = elementColors[targetElement];

            document.getElementById('todayTenGodTitle').innerText = `${advice.title}`;
            document.getElementById('todayTenGodDesc').innerText = advice.desc;
            document.getElementById('luckyAction').innerText = advice.action;
            document.getElementById('luckyColor').innerText = specificColors;
        }

        function analyzeInteraction(uGan, uZhi, tGan, tZhi) {
            let ganRel = null;
            let zhiRel = null;

            if (ganHe[uGan] === tGan) ganRel = "åˆ";
            else if (ganChong[uGan] === tGan) ganRel = "å†²";
            else if (uGan === tGan) ganRel = "åŒ";

            if (zhiHe[uZhi] === tZhi) zhiRel = "åˆ";
            else if (zhiChong[uZhi] === tZhi) zhiRel = "å†²";
            else if (uZhi === tZhi) zhiRel = "åŒ";

            if (ganRel === "åˆ" && zhiRel === "åˆ") return { badge: "å¤§å‰", title: "å¤©åœ°é¸³é¸¯åˆ Â· ä¸‡äº‹é¡ºé‚", desc: "æ—¥æŸ±ä¸æµæ—¥å¤©åˆåœ°åˆï¼Œä¸ºéš¾å¾—çš„å‰æ—¥ï¼äººç¼˜æä½³ï¼Œæ˜“å¾—è´µäººæš—åŠ©ï¼ŒåŠäº‹å¦‚æœ‰ç¥åŠ©ã€‚", type: "great" };
            if (ganRel === "å†²" && zhiRel === "å†²") return { badge: "åŠ¨è¡", title: "å¤©å…‹åœ°å†² Â· å˜åŠ¨ä¹‹è±¡", desc: "æ—¥æŸ±ä¸æµæ—¥å¤©å†²åœ°å…‹ï¼Œè¿åŠ¿æ³¢åŠ¨å‰§çƒˆã€‚æƒ…ç»ªæ˜“ä¸ç¨³ï¼Œæ³¨æ„å‡ºè¡Œå®‰å…¨ä¸å£èˆŒæ˜¯éï¼Œå®œé™ä¸å®œåŠ¨ã€‚", type: "bad" };
            if (ganRel === "åŒ" && zhiRel === "åŒ") return { badge: "ä¼åŸ", title: "æ—¥æŸ±ä¼åŸ Â· æ²‰æ€å†…çœ", desc: "æµæ—¥ä¸æ—¥æŸ±å®Œå…¨ç›¸åŒã€‚èƒ½é‡é‡å ï¼Œå®¹æ˜“åœ¨æ­¤åœ°æ‰“è½¬æˆ–å¿ƒæƒ…éƒé—·ï¼Œé€‚åˆå†…çœã€ç‹¬å¤„ã€‚", type: "warn" };

            if (ganRel === "åˆ") return { badge: "å°å‰", title: "å¤©å¹²äº”åˆ Â· å¤–ç¼˜ä½³", desc: "å¤©å¹²ç›¸åˆï¼Œä»£è¡¨å¯¹å¤–äººé™…å…³ç³»å’Œè°ï¼Œå®¹æ˜“è¾¾æˆå…±è¯†ï¼Œé€‚åˆç¤¾äº¤å’Œè°ˆåˆ¤ã€‚", type: "good" };
            if (zhiRel === "åˆ") return { badge: "å°å‰", title: "åœ°æ”¯å…­åˆ Â· å†…åŠ©å¼º", desc: "åœ°æ”¯ç›¸åˆï¼Œä»£è¡¨å†…å¿ƒè¸å®ï¼Œæš—ä¸­æœ‰è´µäººåŠ©åŠ›ï¼Œå®¶åº­æˆ–ç§äº‹è¾ƒé¡ºã€‚", type: "good" };
            if (ganRel === "å†²") return { badge: "å‹åŠ›", title: "å¤©å¹²ç›¸å†² Â· å‹åŠ›æ˜¾", desc: "å¤©å¹²ç›¸å†²ï¼Œè¡¨é¢å‹åŠ›è¾ƒå¤§ï¼Œå®¹æ˜“æœ‰å£èˆŒäº‰ç«¯æˆ–çªå‘ä»»åŠ¡ï¼Œéœ€æ§åˆ¶è„¾æ°”ã€‚", type: "warn" };
            if (zhiRel === "å†²") return { badge: "å¥”æ³¢", title: "åœ°æ”¯ç›¸å†² Â· èµ°åŠ¨å¤š", desc: "åœ°æ”¯ç›¸å†²ï¼Œä»£è¡¨æ ¹åŸºä¸ç¨³ï¼Œå†…å¿ƒä¸å®‰æˆ–èº«ä½“å°æ™ï¼Œä¹Ÿä¸»èµ°åŠ¨å¥”æ³¢ä¹‹äº‹ï¼Œé€‚åˆå‡ºå·®ã€‚", type: "warn" };

            return { badge: "å¹³ç¨³", title: "è¿åŠ¿å¹³é¡º Â· æŒ‰éƒ¨å°±ç­", desc: "ä»Šæ—¥æ—¥æŸ±ä¸æµæ—¥æ— æ˜æ˜¾å‰§çƒˆå†²åˆï¼Œæ°”åœºç¨³å®šã€‚é€‚åˆæŒ‰æ—¢å®šè®¡åˆ’è¡Œäº‹ï¼Œä¿æŒå¹³å¸¸å¿ƒå³å¯ã€‚", type: "normal" };
        }

        function getTenGodName(me, target) {
            const ganMap = { "ç”²":[0,0], "ä¹™":[0,1], "ä¸™":[1,0], "ä¸":[1,1], "æˆŠ":[2,0], "å·±":[2,1], "åºš":[3,0], "è¾›":[3,1], "å£¬":[4,0], "ç™¸":[4,1] };
            if(!ganMap[me] || !ganMap[target]) return "æ¯”è‚©";

            const [meWx, meYinYang] = ganMap[me];
            const [targetWx, targetYinYang] = ganMap[target];

            const diff = (targetWx - meWx + 5) % 5;
            const sameYinYang = (meYinYang === targetYinYang);

            if(diff === 0) return sameYinYang ? "æ¯”è‚©" : "åŠ«è´¢";
            if(diff === 1) return sameYinYang ? "é£Ÿç¥" : "ä¼¤å®˜";
            if(diff === 2) return sameYinYang ? "åè´¢" : "æ­£è´¢";
            if(diff === 3) return sameYinYang ? "ä¸ƒæ€" : "æ­£å®˜";
            if(diff === 4) return sameYinYang ? "åå°" : "æ­£å°";
            return "æ¯”è‚©";
        }
    </script>
</body>
</html>